<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Maplibre 5.5.0</title>
    <meta property="og:description" content="Use extrusions to display buildings' height in 3D." />
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="../../cdn/maplibre/maplibre5.5.0.css" />
    <script src="../../cdn/maplibre/maplibre5.5.0.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/@sakitam-gis/maplibre-wind@2.0.3/dist/maplibre-wind.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/@sakitam-gis/mapbox-wind@1.0.0-alpha.10/dist/mapbox-wind.js"></script> -->
    <style>
      body {
        margin: 0;
        padding: 0;
      }
      html,
      body,
      #map {
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      const map = new maplibregl.Map({
        container: 'map', // container id
        style: 'https://demotiles.maplibre.org/style.json', // style URL
        center: [0, 0], // starting position [lng, lat]
        zoom: 1 // starting zoom
      });
      window.map = map;

      const particlesConfig = {
        speedFactor: ['interpolate', ['exponential', 0.5], ['zoom'], 0, 1, 15, 0.01],
        fadeOpacity: 0.93,
        dropRate: 0.003,
        dropRateBump: 0.002
      };

      map.on('load', () => {
        const tileSource = new maplibreWind.TileSource('wind', {
          tileSize: 256,
          minZoom: 0,
          maxZoom: 4,
          roundZoom: true,
          decodeType: maplibreWind.DecodeType.imageWithExif,
          wrapX: true,
          // tileBounds: [-78.120282611, -75.191804486, 132.453327310, 68.846393966],
          url: '../assets/wind-surface.jpeg'
        });

        const layer = new maplibreWind.Layer('wind', tileSource, {
          styleSpec: {
            'fill-color': ['interpolate', ['step', 1], ['get', 'value'], 0, '#fff', 104, '#fff'],
            opacity: ['interpolate', ['exponential', 0.5], ['zoom'], 1, 1, 2, 1],
            numParticles: [
              'interpolate',
              ['exponential', 0.5],
              ['zoom'],
              0, // zoom
              65535 / 8, // numParticles
              8, // zoom
              65535 / 16 // numParticles
            ],
            ...particlesConfig
          },
          renderFrom: maplibreWind.RenderFrom.rg,
          displayRange: [0, 104],
          renderType: maplibreWind.RenderType.particles
          // mask: {
          //   data: clip,
          //   // type: maplibreWind.MaskType.outside,
          //   type: maplibreWind.MaskType.inside, // 默认是 inside，即只显示范围内的
          // }
        });

        map.addLayer(layer);
      });
    </script>
  </body>
</html>
